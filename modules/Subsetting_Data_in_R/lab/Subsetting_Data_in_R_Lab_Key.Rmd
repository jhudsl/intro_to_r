---
title: "Subsetting Data in R - Lab"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this lab you can use the interactive console to explore but please record your commands here.  Remember anything you type here can be "sent" to the console with Cmd-Enter (OS-X) or Ctrl-Enter (Windows/Linux) (But only inside the code chunks designated with the ```{r}``` areas).

First let's get the OCSdata package if we haven't already. We added an argument here so you don't have to select a mirror. 

```{r}
install.packages("OCSdata", repos='http://cran.us.r-project.org')
```

```{r, message = FALSE}
# don't forget to load the packages that you will need!
library(dplyr)
library(tidyverse)
library(OCSdata)
```

# Part 1

First let's load the opioid related datasets by running this chunk. Remember that code is denoted with backticks "`" around it in the main text, but do not copy backticks when you paste code elements into code chunks (like the gray section below). 

```{r}
OCSdata::load_imported_data("ocs-bp-opioid-rural-urban")
```

Check that it worked by seeing if you have the `county_pop` data.

```{r}
county_pop
```


1. What class is `county_pop`?

```{r}
class(county_pop)
```

2. How many observations (rows) and variables (columns) are in the dataset - try the `dim()` function?

```{r}
dim(county_pop)
nrow(county_pop)
ncol(county_pop)
```

3.  Next, rename the column `BUYER_STATE`  to be `State_name` (hint - use `rename()` and watch out for the order of the new and old names!). 

```{r}
county_pop <- rename(county_pop, State_name = BUYER_STATE)
head(county_pop)
```

4. Convert the column names of `county_pop` to be all lower case. Use `rename_with()`, and the `tolower` command.

```{r}
county_pop <- rename_with(county_pop, tolower)
head(county_pop)
dim(county_pop)
```


**Bonus / Extra practice**: How can you print the first 3 rows and the last 3 rows of `county_pop` (in two lines of code)?

```{r}
head(county_pop, 3)
tail(county_pop, 3)
```

# Part 2

1. Create a subset of the `county_pop` that only contains the columns: `county_name`, `year`, and `population` and assign this object to `pop_sub` - what are the dimensions of this dataset?

```{r}
pop_sub <- select(county_pop, county_name, year, population)
pop_sub
```

2. Start with `conty_pop` this again instead of the dataset you just made. Subset the data to only include the `population` column and the columns that end with "_name". Hint: use  `select()` and `ends_with()`. Assign this subset of the data to be `pop2`. Again take a look at the data.

```{r}
pop2 <- select(county_pop, population, ends_with("_name"))
pop2
```

3. Pull the variable `county_name` from `pop2`. How does this differ form selecting it?

```{r}
pull(pop2, county_name)
select(pop2, county_name)
```

4. Subset the rows of `county_pop` that have **more** than 20000 miles per gallon (`MPG`) of fuel efficiency - how many are there? Use `filter()`.

```{r}
cars_mpg <- filter(cars_mt_copy, MPG > 20)
dim(cars_mpg)
nrow(cars_mpg)
cars_mpg
```

There are `r nrow(cars_mpg)` cars. 
There are `nrow(cars_mpg)` cars. 


5. Subset the rows of `cars_mt_copy` that get **less** than 16 miles per gallon (`MPG`) of fuel efficiency and **more** than 150 horsepower (`HP`) - how many are there?

```{r}
filter(cars_mt_copy, MPG < 16 & HP > 150) # all of these options work
nrow(filter(cars_mt_copy, MPG < 16 & HP > 150))
nrow(filter(cars_mt_copy, MPG < 16, HP > 150))
cars_mt_copy %>%
  filter(MPG < 16, HP > 150) %>%
  nrow()
```


6. Subset the rows of `cars_mt_copy` that get **less** than 16 miles per gallon (`MPG`) of fuel efficiency **and** **greater than or equal** to 150 horsepower (`HP`) - how many are there?

```{r}
filter(cars_mt_copy, MPG < 16 & HP >= 150) # all of these options work
nrow(filter(cars_mt_copy, MPG < 16 & HP >= 150))
nrow(filter(cars_mt_copy, MPG < 16, HP >= 150))
cars_mt_copy %>%
  filter(MPG < 16, HP >= 150) %>%
  nrow()
```

7. Why do the answers for 5 and 6 differ?

They differ because there are two cars with HP values that are exactly 150.

**Bonus / Extra practice**:

Subset the rows of `cars_mt_copy` for cars that have 4 `CYL`,  **or** **less** than 1.9 WT.
How many cars have both?

```{r}
filter(cars_mt_copy, CYL == 4 | WT < 1.9)
nrow(filter(cars_mt_copy, CYL == 4 & WT < 1.9))
```

**Bonus / Extra practice**: Convert the column names of `carsSub` to all lower case. Take a look at the data.

```{r}
carsSub <- rename_with(carsSub, tolower)
carsSub
```


**Bonus / Extra practice**: Select the variables that contain the letter "A" from `cars_mt_copy`.

```{r}
select(cars_mt_copy, contains("A"))
```

# Part 3

1. Create a subset called `carsSub`from the `cars_mt_copy` data that only contains the columns:
`CAR`,	`WT`, `QSEC`, and `HP` for only the cars with 8 cylinders (`CYL`).
	What are the dimensions of this dataset? Don't use pipes (`%>%`).

```{r}
carsSub <- filter(cars_mt_copy, CYL == 8)
carsSub <- select(carsSub, CAR, WT, QSEC, HP)
carsSub # can get dimensions just from viewing the tibble
dim(carsSub) # alternatively can use dim() function
```

2. Try the same thing again with pipes `%>%`.

```{r}
carsSub <- cars_mt_copy %>%
  filter(CYL == 8) %>%
  select(CAR, WT, QSEC, HP)
carsSub
dim(carsSub)
```

What happens if you do the steps in a different order? Why?

```{r, eval = FALSE}
carsSub <- cars_mt_copy %>%
  select(CAR, WT, QSEC, HP) %>%
  filter(CYL == 8)
```

3. Re-order the rows of `carsSub` by weight (`WT`) in increasing order. Use `arrange()`. What is the heaviest car?

```{r}
carsSub <- arrange(carsSub, WT)
carsSub
arrange(carsSub, desc(WT)) %>%
  head(n = 1) %>%
  pull(CAR)
```


4. Create a new variable in `carsSub` called `WT2`, which  is equal to `WT^2`, using `mutate()`(don't forget to reassign `carsSub`). Use pipes `%>%`:

```{r}
carsSub <- carsSub %>% mutate(WT2 = WT^2)
```


**Bonus / Extra practice**: Move the `WT2` column to be first. Use `relocate()`.

```{r}
carsSub <- carsSub %>% relocate(WT2, .before = CAR)
carsSub
```

**Bonus / Extra practice**: How can you find the value of `WT2` for the Cadillac Fleetwood without just looking at the data manually and instead use functions we learned today?

```{r}
carsSub %>%
  filter(CAR == "Cadillac Fleetwood") %>%
  select(WT2)
```
